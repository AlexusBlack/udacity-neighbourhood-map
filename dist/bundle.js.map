{"version":3,"sources":["webpack:///webpack/bootstrap 51f13d7c2e90ae7cd3b4","webpack:///./src/app.js","webpack:///./src/app-model.js","webpack:///./src/utils/tools.js","webpack:///./src/utils/item-click-handler.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;;;;;AC7DA;AACsD;AACtD;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA,a;;;;;;;;ACtDA;AACA;;AAEA;;AAEA;AACA,aAAa,iCAAiC;AAC9C;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA,2B;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA,C;;;;;;;;;;;;;;ACxBA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;;AAEA;AACA;AACA,mBAAmB,WAAW;AAC9B,GAAG;;AAEH;AACA;AACA,0BAA0B,WAAW;;AAErC;AACA;AACA,OAAO;AACP,kDAAkD,aAAa;AAC/D,+CAA+C,UAAU;AACzD,6DAA6D,WAAW,IAAI,oBAAoB;AAChG;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,YAAY,mBAAmB,GAAG,mBAAmB,SAAS,WAAW;AACzE,mBAAmB,qBAAqB,iBAAiB,yBAAyB;AAClF,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,C;;;;;;;;ACjIA;AACA;AACA,C","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 51f13d7c2e90ae7cd3b4","import AppModel from './app-model';\nimport {showSnackbar, showInfoWindow, closeInfoWindow} from './utils/tools';\nimport itemClickHandler from './utils/item-click-handler';\n\nconst FOURSQUARE_CLIENT_ID = '1TJBD0BFMGT5FJFTNVLRZSP2PLEMDOC0GOFQAJ3NGDY0TTB5';\nconst FOURSQUARE_CLIENT_SECRET = '3NAQ2TJEZ2ZAWHMZ1BKSVQ00WKA325VCADGWQZ2N1WC1BETZ';\n\nconst model = new AppModel();\nko.applyBindings(model);\n\nmodel.filter.subscribe((searchString) => {\n  // saving our search string to localStorage\n  localStorage.searchString = searchString;\n});\n\nconst loadPlaces = async () => {\n  model.errorLoadingPlaces(false);\n  let response;\n  try {\n    response = await fetch('./places.json');\n  } catch(e) {\n    console.error('Looks like there was a problem with loading places list.' + e.message);\n    alert('We were unable to load places list, please try to reload it with button in sidebar');\n    model.errorLoadingPlaces(true);\n    return;\n  }\n\n  if (response.status !== 200) {\n    showSnackbar('Looks like there was a problem with loading places list. Status Code: ' + response.status);\n    return;\n  }\n\n  const placesList = await response.json();\n\n  for(let placeData of placesList) {\n    let place = {\n      name: placeData.name,\n      location: placeData.location,\n      category: placeData.category,\n      active: ko.observable(false)\n    };\n\n    place.active.subscribe((active) => {\n      if(active) {\n        showInfoWindow(place);\n      } else {\n        closeInfoWindow(place);\n      }\n    });\n\n    model.places.push(place);\n  }\n}\n\nloadPlaces();\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app.js\n// module id = 0\n// module chunks = 0","export default function AppModel() {\n  let self = this;\n\n  this.errorLoadingPlaces = ko.observable(false);\n\n  this.map = ko.observable({\n    center: {lat: -37.821410, lng: 144.959343},\n    zoom: 15\n  });\n\n  this.filter = ko.observable(localStorage.searchString || '');\n  this.places = ko.observableArray([]);\n\n  this.filteredPlaces = ko.computed(() => {\n    if(!self.filter()) {\n      return self.places(); \n    }\n    return ko.utils.arrayFilter(\n      self.places(), \n      (place) => filterPlaceBySearchString(place, self.filter())\n    );\n  });\n\n  this.selectPlace = function(e) {\n    this.active(true);\n  }\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app-model.js\n// module id = 1\n// module chunks = 0","export {\n  clearMap, showSnackbar, createMarker, showInfoWindow, closeInfoWindow, setActivePlace, getFoursquareData\n}\n\nfunction clearMap(map) {\n  if(!(map.markers == null)) {\n    for(let marker of map.markers) {\n      // closing info windows if open\n      if(!(marker.infoWindow == null)) {\n        marker.infoWindow.close();\n      }\n      // removing marker\n      marker.setMap(null);\n    }\n  }\n  // cleaning markers storage\n  map.markers = [];\n}\n\nfunction getPlaceIcon(place) {\n  if(place.category == 'groceries') {\n    return './img/shop-icon.svg';\n  } else if(place.category == 'geeks') {\n    return './img/geek-icon.svg';\n  } else if(place.category == 'restorant') {\n    return './img/restaurant-icon.svg';\n  }\n}\n\nfunction showSnackbar(message, timeout = -1) {\n  if(timeout == -1) timeout = 2000;\n  const snackbarContainer = document.getElementById('snackbar-container');\n  const data = {\n    message: message,\n    timeout: timeout\n  };\n  snackbarContainer.MaterialSnackbar.showSnackbar(data);\n}\n\nfunction createMarker(place) {\n  let marker = new google.maps.Marker({\n    position: place.location,\n    map: null,\n    title: place.name,\n    icon: getPlaceIcon(place)\n  });\n\n  marker.addListener('click', () => setActivePlace(place));\n\n  return marker;\n}\n\nfunction createInfoWindow(place) {\n  const infoWindow = new google.maps.InfoWindow({\n    content: `<b>${place.name}</b><br><br>Loading...`\n  });\n\n  getFoursquareData(place).then(\n    (info) => {\n      let content = `<b>${place.name}</b><br><br>`;\n\n      if(info == null) {\n        content += `<i>Load error</i>`;\n      } else {\n        if(!(info.address == null)) content += `${info.address}<br>`;\n        if(!(info.city == null)) content += `${info.city}<br>`;\n        if(!(info.phone == null)) content += `<a href='tel:${info.phone}'>${info.formattedPhone}</a>`;\n      }\n      \n      infoWindow.setContent(content);\n    }\n  );\n\n  return infoWindow;\n}\n\nfunction showInfoWindow(place) {\n  if(place.marker.infoWindow == null) {\n    place.marker.infoWindow = createInfoWindow(place);\n  }\n\n  place.marker.setAnimation(google.maps.Animation.BOUNCE);\n  setTimeout(() => {\n    place.marker.setAnimation(null);\n  }, 750);\n\n  place.marker.infoWindow.open(place.marker.map, place.marker);\n}\n\nfunction closeInfoWindow(place) {\n  place.marker.infoWindow.close();\n}\n\nfunction setActivePlace(placeToActivate) {\n  if(placeToActivate.active()) return;\n  for(var place of model.places()) {\n    if(place != placeToActivate) {\n      place.active(false);\n    } else {\n      place.active(true);\n    }\n  }\n}\n\nasync function getFoursquareData(place) {\n  let response\n  try {\n    response = await fetch(`https://api.foursquare.com/v2/venues/search?` + \n      `ll=${place.location.lat},${place.location.lng}&query=${place.name}&` +\n      `client_id=${FOURSQUARE_CLIENT_ID}&client_secret=${FOURSQUARE_CLIENT_SECRET}&v=20180122`);\n  } catch(e) {\n    showSnackbar('Unable to access foursquare ' + e.message);\n    return;\n  }\n  \n  if (response.status !== 200) {\n    showSnackbar('Looks like there was a problem with loading foursquare info. Status Code: ' + response.status);\n    return;\n  }\n  \n  const data = await response.json();\n  const placeData = data.response.venues[0];\n  const info = {\n    address: placeData.location.address,\n    city: placeData.location.city,\n    phone: placeData.contact.phone,\n    formattedPhone: placeData.contact.formattedPhone\n  };\n  return info;\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/utils/tools.js\n// module id = 2\n// module chunks = 0","export default function itemClickHandler(e) {\n  setActivePlace(this);\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/utils/item-click-handler.js\n// module id = 3\n// module chunks = 0"],"sourceRoot":""}